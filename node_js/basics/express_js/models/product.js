
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //      Import And Set Data And File Starts
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	const fs = require('fs');

	const rootDir = require('../utils/path');
	const p = rootDir + '/data/products.json';

// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //      Import And Set Data And File Ends
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //      Helper Functions Starts
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// Callback() - it ensures we wait for the file read operation (which is asynchronous) before continuing, `fs.readFile()` is asynchronous â€” it takes time to complete.
	const getProductsFromFile = cb => {
		
		// If the file doesn't exist or has an error, return an empty array
		fs.readFile(p, (err, fileContent) => {
			if (err) {
				cb([]); 
			} else {
				cb(JSON.parse(fileContent)); 
			}
		});

	};

// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //      Helper Functions Ends
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
			//      Products Model Class Definition Starts
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	module.exports = class Product {
		constructor(title, imageUrl, description, price) {
			this.title = title;
			this.imageUrl = imageUrl;
			this.description = description;
			this.price = price;
		}

		save() {
			getProductsFromFile(products => {
				products.push(this);
				fs.writeFile(p, JSON.stringify(products), err => {
					console.log(err);
				});
			});
		}

		static fetchAll(cb) {
			getProductsFromFile(cb);
		}
	};

// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
            //      Products Model Class Definition Ends
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------